<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:madcap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" madcap:lastblockdepth="2" madcap:lastheight="135.6667" madcap:lastwidth="592" madcap:disablemasterstylesheet="true" madcap:tocpath="Programming|Routines|Data Control|ENVI Classic" madcap:medium="non-print" madcap:inpreviewmode="false" madcap:preloadimages="false" madcap:runtimefiletype="Topic" madcap:targettype="WebHelp" lang="en-us" xml:lang="en-us" madcap:pathtohelpsystem="../../../../" madcap:helpsystemfilename="ENVIHelp.xml" madcap:searchtype="Stem">
 <!-- saved from url=(0014)about:internet -->
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
   ENVI_CONVERT_FILE_MAP_PROJECTION
  </title>
  <link href="../../../SkinSupport/MadCap.css" rel="stylesheet" />
  <link href="../../../Resources/Stylesheets/Doc_Style.css" rel="stylesheet" />
  <script src="../../../SkinSupport/MadCapAll.js" type="text/javascript">
  </script>
 </head>
 <body>
  <p class="MCWebHelpFramesetLink" style="display: none;">
   <a href="../../../../ENVIHelp_CSH.htm#ExtendCustomize/ENVIClassicAPI/ENVI_C/ENVI_CONVERT_FILE_MAP_PROJECTION.htm" style="">
    Open topic with navigation
   </a>
  </p>
  <div class="MCBreadcrumbsBox_0">
   <span class="MCBreadcrumbsPrefix">
    <![CDATA[ ]]>
   </span>
   <a class="MCBreadcrumbsLink" href="../../ProgrammingWithENVI.htm">
    Programming
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <a class="MCBreadcrumbsLink" href="../../Routines.htm">
    Routines
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <a class="MCBreadcrumbsLink" href="../../ENVICoordSys.htm">
    Data Control
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <span class="MCBreadcrumbs">
    ENVI_CONVERT_FILE_MAP_PROJECTION
   </span>
  </div>
  <h1>
   <a name="kanchor525">
   </a>
   ENVI_CONVERT_FILE_MAP_PROJECTION
  </h1>
  <p>
   <a href="#Syntax">
    Syntax
   </a>
   |
   <a href="#Keywords">
    Keywords
   </a>
   |
   <a href="#Example">
    Example
   </a>
  </p>
  <p>
   Use this procedure to convert a file from its current map projection to a specified output projection. This procedure requires an input file, the output projection, and the resampling and warping method; no ground control points are needed (they are generated internally). This procedure converts among many projections in
   <span class="DocumentTitleProductNameENVIClassic">
    ENVI Classic
   </span>
   . Neither the input nor output projection can be Arbitrary.
  </p>
  <h2 class="API">
   <a name="Syntax">
   </a>
   Syntax
  </h2>
  <p>
   ENVI_CONVERT_FILE_MAP_PROJECTION [,
   <a href="#BACKGROUND">
    BACKGROUND
   </a>
   =
   <i>
    integer
   </i>
   ] [,
   <a href="#DEGREE">
    DEGREE
   </a>
   =
   <i>
    value
   </i>
   ],
   <a href="#DIMS">
    DIMS
   </a>
   =
   <i>
    array
   </i>
   ,
   <a href="#FID">
    FID
   </a>
   =
   <i>
    file ID
   </i>
   [,
   <a href="#GCP_NAME">
    GCP_NAME
   </a>
   =
   <i>
    string
   </i>
   ] [,
   <a href="#GRID">
    GRID
   </a>
   =
   <i>
    array
   </i>
   ] [,
   <a href="#O_PIXEL_SIZE">
    O_PIXEL_SIZE
   </a>
   =
   <i>
    array
   </i>
   ],
   <a href="#O_PROJ">
    O_PROJ
   </a>
   =
   <i>
    structure
   </i>
   [,
   <a href="#O_BNAME">
    OUT_BNAME
   </a>
   =
   <i>
    string array
   </i>
   ],
   <a href="#OUT_NAME">
    OUT_NAME
   </a>
   =
   <i>
    string
   </i>
   ,
   <a href="#POS">
    POS
   </a>
   =
   <i>
    array
   </i>
   [,
   <a href="#R_FID">
    R_FID
   </a>
   =
   <i>
    variable
   </i>
   ] [,
   <a href="#RESAMPLING">
    RESAMPLING
   </a>
   ={0 | 1 | 2}] [,
   <a href="#WARP_METHOD">
    WARP_METHOD
   </a>
   ={0 | 1 | 2 | 3}] [, /
   <a href="#ZERO_EDGE">
    ZERO_EDGE
   </a>
   ]
  </p>
  <h2 class="API">
   <a name="Keywords">
   </a>
   Keywords
  </h2>
  <h3>
   <a name="BACKGROUND">
   </a>
   BACKGROUND (optional)
  </h3>
  <p>
   Use this keyword to specify the output image background value. All pixels outside the warped-image boundary will be set to this value. The default is 0.
  </p>
  <h3>
   <a name="DEGREE">
   </a>
   DEGREE (optional)
  </h3>
  <p>
   Use this keyword to specify the degree of the warping polynomial for the polynomial method. The degree of the polynomial is limited by the number of ground control points (GCPs). You must ensure that
   <i>
    #GCPs
   </i>
   &gt; (
   <i>
    DEGREE
   </i>
   + 1)
   <span style="vertical-align: super;font-size: 9pt;">
    2
   </span>
   . The default value is 1 (first-degree polynomial).
  </p>
  <h3>
   <a name="DIMS">
   </a>
   DIMS
  </h3>
  <p>
   The “dimensions” keyword is a five-element array of long integers that defines the spatial subset (of a file or array) to use for processing. Nearly every time you specify the keyword FID, you must also specify the spatial subset of the corresponding file (even if the entire file, with no spatial subsetting, is to be processed).
  </p>
  <ul>
   <li value="1">
    DIMS[0]: Unused for this routine; set to -1L.
   </li>
   <li value="2">
    DIMS[1]: The starting sample number. The first x pixel is 0.
   </li>
   <li value="3">
    DIMS[2]: The ending sample number
   </li>
   <li value="4">
    DIMS[3]: The starting line number. The first y pixel is 0.
   </li>
   <li value="5">
    DIMS[4]: The ending line number
   </li>
  </ul>
  <p>
   To process an entire file (with no spatial subsetting), define DIMS as shown in the following code example. This example assumes you have already opened a file using ENVI_SELECT or ENVI_PICKFILE:
  </p>
  <pre xml:space="preserve">
   envi_file_query, fid, dims=dims
  </pre>
  <h3>
   <a name="FID">
   </a>
   FID
  </h3>
  <p>
   The file ID (FID) is a long-integer scalar with a value greater than 0. An invalid FID has a value of -1. The FID is provided as a named variable by any routine used to open or select a file. Often, the FID is returned from the keyword R_FID in the
   <a href="../../ENVIRasterToFID.htm">
    ENVIRasterToFID
   </a>
   routine. Files are processed by referring to their FIDs. If you work directly with the file in IDL, the FID is
   <i>
    not
   </i>
   equivalent to a logical unit number (LUN).
  </p>
  <h3>
   <a name="GCP_NAME">
   </a>
   GCP_NAME (optional)
  </h3>
  <p>
   Use this optional string keyword to specify the output filename for the warp points. If WARP_METHOD=3, this keyword is ignored.
  </p>
  <h3>
   <a name="GRID">
   </a>
   GRID (optional)
  </h3>
  <p>
   Use this keyword to specify a two-element array of long integers representing the grid spacing in pixels for the x and y warp points, respectively, used to convert between the two map projections. Regardless of the GRID value, a minimum of four corner points will be used. The default is to use every 10th point in both x and y. If WARP_METHOD=3, this keyword is ignored.
  </p>
  <h3>
   <a name="O_PIXEL_SIZE">
   </a>
   O_PIXEL_SIZE (optional)
  </h3>
  <p>
   Use this keyword to specify a two-element array of double-precision values representing the x and y pixel sizes, respectively.
  </p>
  <h3>
   <a name="O_PROJ">
   </a>
   O_PROJ
  </h3>
  <p>
   Use this keyword to specify the output projection for the converted file. You cannot set O_PROJ to the Arbitrary projection. O_PROJ is a projection structure returned from
   <a href="../ENVI_G/ENVI_GET_PROJECTION.htm">
    ENVI_GET_PROJECTION
   </a>
   or
   <a href="../ENVI_P/ENVI_PROJ_CREATE.htm">
    ENVI_PROJ_CREATE
   </a>
   .
  </p>
  <h3>
   <a name="O_BNAME">
   </a>
   OUT_BNAME (optional)
  </h3>
  <p>
   Use this keyword to specify a string array of output band names.
  </p>
  <h3>
   <a name="OUT_NAME">
   </a>
   OUT_NAME
  </h3>
  <p>
   Use this keyword to specify a string with the output filename for the resulting data. If you set the keyword IN_MEMORY, you do not need to specify OUT_NAME.
  </p>
  <h3>
   <a name="POS">
   </a>
   POS
  </h3>
  <p>
   Use this keyword to specify an array of band positions, indicating the band numbers on which to perform the operation. This keyword indicates the spectral subset of bands to use in processing. POS is an array of long integers, ranging from 0 to the number of bands minus 1. Specify bands starting with zero (Band 1=0, Band 2=1, etc.) For example, to process only Bands 3 and 4 of a multi-band file, POS=[2, 3].
  </p>
  <p>
   POS is typically used with individual files. The example code below for
   <a href="../ENVI_S/ENVI_STATS_DOIT.htm">
    ENVI_STATS_DOIT
   </a>
   illustrates the use of POS for a single file with four bands of data:
  </p>
  <p class="Code_Indented">
   pos=[0,1,2,3]
  </p>
  <p class="Code_Indented">
   <br />
   envi_doit, 'envi_stats_doit', dims=dims, fid=fid, pos=pos, $
  </p>
  <p class="Code_Indented">
   <br />
   comp_flag=3, dmin=dmin, dmax=dmax, mean=mean, stdv=stdv, hist=hist
  </p>
  <p>
   But what if you need to create an output file consisting of data from different bands, each from different files? Library routines such as
   <a href="../C/CF_DOIT.htm">
    CF_DOIT
   </a>
   and
   <a href="../ENVI_L/ENVI_LAYER_STACKING_DOIT.htm">
    ENVI_LAYER_STACKING_DOIT
   </a>
   can accomplish this, but they use the POS keyword differently. Suppose you have four files,
   <code>
    test1
   </code>
   ,
   <code>
    test2
   </code>
   ,
   <code>
    test3
   </code>
   , and
   <code>
    test4
   </code>
   , with corresponding FIDs of
   <code>
    fid1
   </code>
   ,
   <code>
    fid2
   </code>
   ,
   <code>
    fid3
   </code>
   , and
   <code>
    fid4
   </code>
   , respectively. In the following example, you want Band 3 from
   <code>
    test1
   </code>
   in the first position, Band 2 from
   <code>
    test2
   </code>
   in the second position, Band 6 from
   <code>
    test3
   </code>
   in the third position, and Band 4 from
   <code>
    test4
   </code>
   in the fourth position. The code should be as follows:
  </p>
  <p class="Code_Indented">
   fid_array = [fid1,fid2,fid3,fid4]
  </p>
  <p class="Code_Indented">
   <br />
   pos=[2,1,5,3]
  </p>
  <p class="Code_Indented">
   <br />
   envi_doit, 'cf_doit', dims=dims, fid=fid_array
  </p>
  <p class="Code_Indented">
   <br />
   out_name='test_composite_file'
  </p>
  <h3>
   <a name="R_FID">
   </a>
   R_FID (optional)
  </h3>
  <p>
   <span class="DocumentTitleProductNameENVIClassic">
    ENVI Classic
   </span>
   library routines that result in new images also have an R_FID, or “returned FID.” This is simply a named variable containing the file ID to access the processed data. Specifying this keyword saves you the step of opening the new file from disk.
  </p>
  <h3>
   <a name="RESAMPLING">
   </a>
   RESAMPLING (optional)
  </h3>
  <p>
   Set this keyword to one of the following values to specify the resampling method:
  </p>
  <ul>
   <li value="1">
    0: Nearest neighbor
   </li>
   <li value="2">
    1: Bilinear
   </li>
   <li value="3">
    2: Cubic convolution
   </li>
  </ul>
  <p>
   The default method is nearest neighbor.
  </p>
  <h3>
   <a name="WARP_METHOD">
   </a>
   WARP_METHOD (optional)
  </h3>
  <p>
   Set this keyword to one of the following values to specify the warp or rigorous projection method:
  </p>
  <ul>
   <li value="1">
    0: Rotation, scaling, and translation (RST)
   </li>
   <li value="2">
    1: Polynomial
   </li>
   <li value="3">
    2: Triangulation
   </li>
   <li value="4">
    3: Rigorous (pixel-by-pixel)
   </li>
  </ul>
  <p>
   The default method is RST.
  </p>
  <p>
   If WARP_METHOD=3, the GCP_NAME and GRID keywords are ignored.
  </p>
  <h3>
   <a name="ZERO_EDGE">
   </a>
   ZERO_EDGE (optional)
  </h3>
  <p>
   Set this keyword to specify that the edges outside of any triangles are set to the value specified by BACKGROUND. The keyword is used only for triangulation (WARP_METHOD=2).
  </p>
  <h2 class="API">
   <a name="Example">
   </a>
   Example
  </h2>
  <p>
   The following example converts the file
   <code>
    bhtmref.img
   </code>
   from UTM zone 13 North to UTM zone 12 North.
  </p>
  <p>
   Create the output UTM projection using
   <a href="../ENVI_P/ENVI_PROJ_CREATE.htm">
    ENVI_PROJ_CREATE
   </a>
   , with UTM Zone 12 North, the default datum of North America 1927, and the default units of meters. Set the output pixel size to 28.5 meters for both x and y. Use the RST method with bilinear resampling for conversion.
  </p>
  <p class="Code">
   forward_function ENVI_PROJ_CREATE
  </p>
  <p class="Code">
   PRO EXAMPLE_ENVI_CONVERT_FILE_MAP_PROJECTION
  </p>
  <p class="Code_Indented">
   compile_opt IDL2
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   ; First restore all the base save files.
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   envi, /restore_base_save_files
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   ; Initialize ENVI and send all errors
  </p>
  <p class="Code_Indented">
   ; and warnings to the file batch.txt
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   envi_batch_init, log_file='batch.txt'
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   ; Open the input file
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   envi_open_file, 'bhtmref.img', r_fid=fid
  </p>
  <p class="Code_Indented">
   if (fid eq -1) then begin
  </p>
  <p class="Code_Indented">
   &#160;&#160;&#160;envi_batch_exit
  </p>
  <p class="Code_Indented">
   &#160;&#160;&#160;return
  </p>
  <p class="Code_Indented">
   endif
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   ; Setup the values for the keywords
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   envi_file_query, fid, dims=dims, nb=nb
  </p>
  <p class="Code_Indented">
   pos  = lindgen(nb)
  </p>
  <p class="Code_Indented">
   out_name = 'testimg'
  </p>
  <p class="Code_Indented">
   o_proj = envi_proj_create(/utm, zone=12)
  </p>
  <p class="Code_Indented">
   o_pixel_size = [28.5, 28.5]
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   ; Call the doit
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   envi_convert_file_map_projection, fid=fid, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;&#160;pos=pos, dims=dims, o_proj=o_proj, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;&#160;o_pixel_size=o_pixel_size, grid=[50,50], $
  </p>
  <p class="Code_Indented">
   &#160;&#160;&#160;out_name=out_name, warp_method=0, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;&#160;resampling=1, background=0
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   ; Exit ENVI
  </p>
  <p class="Code_Indented">
   ;
  </p>
  <p class="Code_Indented">
   envi_batch_exit
  </p>
  <p class="Code">
   END
  </p>
  <div class="mp_footer">
   Copyright ©
   <span class="DocumentTitleCopyrightYear">
    2012
   </span>
   <![CDATA[ ]]>
   <span class="DocumentTitleCopyrightCompanyName">
    Exelis Visual Information Solutions, Inc.
   </span>
   All Rights Reserved.
  </div>
  <script type="text/javascript" src="../../../SkinSupport/MadCapBodyEnd.js">
  </script>
 </body>
</html>