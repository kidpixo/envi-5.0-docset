<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:madcap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" madcap:lastblockdepth="2" madcap:lastheight="135.6667" madcap:lastwidth="592" madcap:disablemasterstylesheet="true" madcap:tocpath="Programming|Routines|Processing" madcap:medium="non-print" madcap:inpreviewmode="false" madcap:preloadimages="false" madcap:runtimefiletype="Topic" madcap:targettype="WebHelp" lang="en-us" xml:lang="en-us" madcap:pathtohelpsystem="../../../../" madcap:helpsystemfilename="ENVIHelp.xml" madcap:searchtype="Stem">
 <!-- saved from url=(0014)about:internet -->
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
   ENVI_RIGOROUS_ORTHO_DOIT
  </title>
  <link href="../../../SkinSupport/MadCap.css" rel="stylesheet" />
  <link href="../../../Resources/Stylesheets/Doc_Style.css" rel="stylesheet" />
  <script src="../../../SkinSupport/MadCapAll.js" type="text/javascript">
  </script>
 </head>
 <body>
  <p class="MCWebHelpFramesetLink" style="display: none;">
   <a href="../../../../ENVIHelp_CSH.htm#ExtendCustomize/ENVIClassicAPI/ENVI_R/ENVI_RIGOROUS_ORTHO_DOIT.htm" style="">
    Open topic with navigation
   </a>
  </p>
  <div class="MCBreadcrumbsBox_0">
   <span class="MCBreadcrumbsPrefix">
    <![CDATA[ ]]>
   </span>
   <a class="MCBreadcrumbsLink" href="../../ProgrammingWithENVI.htm">
    Programming
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <a class="MCBreadcrumbsLink" href="../../Routines.htm">
    Routines
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <a class="MCBreadcrumbsLink" href="../A/ADAPT_FILT_DOIT.htm">
    Processing
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <span class="MCBreadcrumbs">
    ENVI_RIGOROUS_ORTHO_DOIT
   </span>
  </div>
  <h1>
   <a name="kanchor724">
   </a>
   ENVI_RIGOROUS_ORTHO_DOIT
  </h1>
  <p>
   This procedure automates the
   <a href="../../../GeorectifyImagery/RigorousOrthorectification/Introduction.htm">
    ENVI Orthorectification Module
   </a>
   workflow for  programmers. You must have the ENVI Orthorectification Module licensed and installed in order to use this procedure.
  </p>
  <h2 class="API">
   <a name="Syntax">
   </a>
   Syntax
  </h2>
  <p>
   ENVI_RIGOROUS_ORTHO_DOIT [, /
   <a href="#AUTO_COLOR">
    AUTO_COLOR
   </a>
   ],
   <a href="#DEM_FID">
    DEM_FID
   </a>
   =
   <i>
    file IDs
   </i>
   ,
   <a href="#DEM_POS">
    DEM_POS
   </a>
   =
   <i>
    array
   </i>
   ,
   <a href="#FID">
    FID
   </a>
   =
   <i>
    file IDs
   </i>
   [,
   <a href="#FILETYPE">
    FILETYPE
   </a>
   =
   <i>
    string
   </i>
   ] [,
   <a href="#GCPS">
    GCPS
   </a>
   =
   <i>
    array
   </i>
   ],
   <a href="#OUT_NAME">
    OUT_NAME
   </a>
   =
   <i>
    string
   </i>
   ,
   <a href="#PIXEL_SIZE">
    PIXEL_SIZE
   </a>
   =
   <i>
    variable
   </i>
   ,
   <a href="#R_FID">
    R_FID
   </a>
   =
   <i>
    variable
   </i>
   [,
   <a href="#TIE_POINTS">
    TIE_POINTS
   </a>
   =
   <i>
    array
   </i>
   ]
  </p>
  <h2 class="API">
   <a name="Keywords">
   </a>
   Keywords
  </h2>
  <h3>
   <a name="AUTO_COLOR">
   </a>
   AUTO_COLOR
  </h3>
  <p>
   Set this keyword to perform automatic color and contrast adjustment in the output mosaic. See Step 3 in
   <a href="../../../GeorectifyImagery/RigorousOrthorectification/SelectingOutputParameters.htm">
    Selecting Output Parameters
   </a>
   .
  </p>
  <h3>
   <a name="DEM_FID">
   </a>
   DEM_FID
  </h3>
  <p>
   Set this keyword to an array of one or more file IDs representing digital elevation model (DEM) files. A file ID is a long-integer scalar with a value greater than 0. An invalid FID has a value of -1. The FID is provided as a named variable by one of several
   <span class="DocumentTitleProductName">
    ENVI
   </span>
   routines used to open or select an input file.
  </p>
  <h3>
   <a name="DEM_POS">
   </a>
   DEM_POS
  </h3>
  <p>
   Use this keyword to specify an array of band positions for the input DEM files, indicating the band numbers to use. DEM_POS is an array of long integers, ranging from 0 to the number of bands minus 1. Specify bands starting with zero (Band 1=0, Band 2=1, etc.). DEM_POS must consist of the same number of array elements as DEM_FID.
  </p>
  <h3>
   <a name="FID">
   </a>
   FID
  </h3>
  <p>
   Set this keyword to an array of one or more file IDs representing the input images used for orthorectification. The file ID (FID) is a long-integer scalar with a value greater than 0. An invalid FID has a value of -1. The FID is provided as a named variable by one of several
   <span class="DocumentTitleProductName">
    ENVI
   </span>
   routines used to open or select an input file.
  </p>
  <p>
   The order of file IDs in the FID array determines the image stack order (see
   <a href="../../../GeorectifyImagery/RigorousOrthorectification/LayoutManager.htm#ChangingStackOrder">
    Change the Image Stack Order
   </a>
   and
   <a href="../../../GeorectifyImagery/RigorousOrthorectification/ReorderingImagesDefiningCutlines.htm#Set">
    Set the Image Order
   </a>
   ). For example, if you want FID3 on top, FID1 in the middle, and FID2 on the bottom of the image stack for the output mosaic, set FID as follows:
   <code>
    FID= [fid3, fid1, fid2]
   </code>
   .
  </p>
  <h3>
   <a name="FILETYPE">
   </a>
   FILETYPE
  </h3>
  <p>
   Set this keyword to an
   <code>
    ‘ENVI’
   </code>
   or
   <code>
    ‘GeoTiff’
   </code>
   string to indicate the output file format.
  </p>
  <h3>
   <a name="GCPS">
   </a>
   GCPS
  </h3>
  <p>
   Set this keyword to a string scalar with the filename of a single
   <a href="../../../GeorectifyImagery/RigorousOrthorectification/CollectingEditingGroundControlPoints.htm#GCP">
    <span class="DocumentTitleProductName">
     ENVI
    </span>
    Orthorectification GCP file
   </a>
   , or to a string array with the filenames of multiple GCP files.
  </p>
  <h3>
   <a name="OUT_NAME">
   </a>
   OUT_NAME
  </h3>
  <p>
   Use this keyword to specify a string with the output filename for the resulting data.
  </p>
  <h3>
   <a name="PIXEL_SIZE">
   </a>
   PIXEL_SIZE
  </h3>
  <p>
   Use this keyword to specify the square pixel size. PIXEL_SIZE is a single, double-precision variable that specifies the output square pixel size in meters.
  </p>
  <h3>
   <a name="R_FID">
   </a>
   R_FID
  </h3>
  <p>
   Set this keyword to a named variable containing the file ID to access the processed data. Specifying this keyword saves you the step of opening the new file from disk.
  </p>
  <h3>
   <a name="TIE_POINTS">
   </a>
   TIE_POINTS
  </h3>
  <p>
   Set this keyword to a string scalar with the filename for a single
   <a href="../../../GeorectifyImagery/RigorousOrthorectification/CollectingEditingTiePoints.htm#Tie">
    <span class="DocumentTitleProductName">
     ENVI
    </span>
    Orthorectification tie points file
   </a>
   , or to a string array with the filenames of multiple tie points files.
  </p>
  <h2 class="API">
   <a name="Example">
   </a>
   Example
  </h2>
  <p>
   This example orthorectifies two QuickBird scenes of Phoenix, Arizona, USA, which are available on the
   <span class="DocumentTitleProductName">
    ENVI
   </span>
   Resource DVD. It demonstrates how to open the imagery, DEM, GCP file, and tie points file. The output initially is in a UTM WGS-84 projection, but it will be reprojected into a geographic coordinate system (latitude/longitude).
  </p>
  <h3>
   Prepare Input Data
  </h3>
  <p>
   You will copy the input data for this project to a local directory.
  </p>
  <ol>
   <li value="1">
    Create a new, writeable directory called
    <code>
     workdata
    </code>
    at the root level of your C: drive (
    <code>
     C:\workdata
    </code>
    ).
   </li>
   <li value="2">
    On the
    <span class="DocumentTitleProductName">
     ENVI
    </span>
    Resource DVD, navigate to the
    <code>
     rigorous_ortho
    </code>
    directory.
   </li>
   <li value="3">
    Copy the file
    <code>
     phoenix_DEM_subset.tif
    </code>
    to
    <code>
     workdata
    </code>
    . This is a DEM of the Phoenix area, subsetted to the area encompassing the imagery.
   </li>
   <li value="4">
    On the
    <span class="DocumentTitleProductName">
     ENVI
    </span>
    Resource DVD, navigate to the
    <code>
     rigorous_ortho\005606990010_01_P008_MUL
    </code>
    directory. Copy all of the files in this directory into your
    <code>
     workdata
    </code>
    directory. These files comprise the QuickBird imagery of Phoenix from 11 July 2005.
   </li>
   <li value="5">
    On the
    <span class="DocumentTitleProductName">
     ENVI
    </span>
    Resource DVD, navigate to the
    <code>
     rigorous_ortho\005606990010_01_P011_MUL
    </code>
    directory. Copy all of the files in this directory into your
    <code>
     workdata
    </code>
    directory. These files comprise the QuickBird imagery of Phoenix from 09 October 2005.
   </li>
   <li value="6">
    Using a text editor such as Notepad, copy the following GCP content into a new file called
    <code>
     phx_GCPs.pts
    </code>
    , and place it in your
    <code>
     workdata
    </code>
    directory.
   </li>
   <pre xml:space="preserve">
    ; ENVI Rigorous Orthorectification GCP File
; FileName0=C:\workdata\05OCT09183407-M1BS-005606990010_01_P011.TIF
; FileName1=C:\workdata\05JUL11182931-M1BS-005606990010_01_P008.TIF
; projection info = {Geographic Lat/Lon, WGS-84, units=Degrees}
; ImageFile#, Map (x,y,elev), Image (x,y)
;
1       -112.004007         33.417396        311.083000       3569.000000        479.000000
1       -112.094899         33.385167        309.603000        245.000000       1861.000000
1       -112.038770         33.388203        316.788000       2263.000000       1788.000000
1       -112.074479         33.413951        296.985000        910.000000        621.000000
1       -111.978822         33.380607        336.632000       4521.000000       2143.000000
1       -111.930535         33.402122        327.582000       6332.000000       1181.000000
0       -111.894365         33.390883        333.140000       1279.000000       1631.000000
0       -111.900306         33.419145        329.810000       1058.000000        385.000000
   </pre>
   <p class="Note" madcap:autonum="&lt;b&gt;Note: &lt;/b&gt;">
    <span class="autonumber">
     <span>
      <b>
       Note:
      </b>
     </span>
    </span>
    You may be prompted, “You are about to save the document in a Text-Only format, which will remove all formatting. Are you sure you want to do this?” Click
    <b>
     Yes
    </b>
    .
   </p>
   <li value="7">
    Copy the following tie point information into a new file called
    <code>
     phx_TIEs.pts
    </code>
    , and place it in your
    <code>
     workdata
    </code>
    directory.
   </li>
   <pre xml:space="preserve">
    ; ENVI Rigorous Orthorectification TiePoint File
; FileName0=C:\workdata\05OCT09183407-M1BS-005606990010_01_P011.TIF
; FileName1=C:\workdata\05JUL11182931-M1BS-005606990010_01_P008.TIF
; Image1File#, Image2File#, Image1(ImageX, ImageY), Image2(ImageX, ImageY)
;
    1    0     6737.000000        511.750000     363.750000        480.000000
    1    0     6860.250000       1997.750000     489.750000       1928.000000
    1    0     6835.500000       3174.000000     471.750000       3073.500000
   </pre>
  </ol>
  <h3>
   Run the Program
  </h3>
  <p>
   Copy the following code into a new IDL file named
   <code style="font-weight: bold;">
    ortho_doit_example.pro
   </code>
   , and save it to your IDL working directory. Compile and run the program in
   <span class="DocumentTitleProductNameENVIClassic">
    ENVI Classic
   </span>
   +IDL (available from the Windows
   <b>
    Start
   </b>
   menu &gt;
   <b>
    Programs &gt; ENVI
    <i>
     xx
    </i>
    &gt; Tools
   </b>
   .
  </p>
  <p class="Code">
   PRO ORTHO_DOIT_EXAMPLE
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   ; Output Parameters
  </p>
  <p class="Code_Indented">
   pixel_size = 15.0d      ; Set the square pixel size in meters
  </p>
  <p class="Code_Indented">
   filetype = 'GeoTiff'      ; Set file output type to GeoTiff
  </p>
  <p class="Code_Indented">
   autocolor = 0             ; Turn off auto color balancing
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   ; Set the output filename
  </p>
  <p class="Code_Indented">
   filename1 = 'c:\workdata\Ortho_Output.tif'
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   ; Input data
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   inputimage1 = 'c:\workdata\05JUL11182931-M1BS-005606990010_01_P008.TIF'
  </p>
  <p class="Code_Indented">
   inputimage2 = 'c:\workdata\05OCT09183407-M1BS-005606990010_01_P011.TIF'
  </p>
  <p class="Code_Indented">
   inputdem = 'c:\workdata\phoenix_DEM_subset.tif'
  </p>
  <p class="Code_Indented">
   inputgcps = 'c:\workdata\phx_GCPs.pts'
  </p>
  <p class="Code_Indented">
   inputties= 'c:\workdata\phx_TIEs.pts'
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   ; Load images and DEMs into ENVI Classic and set sensor type
  </p>
  <p class="Code_Indented">
   ; Open image 1
  </p>
  <p class="Code_Indented">
   ENVI_OPEN_DATA_FILE, inputimage1, /TIFF, R_FID = fid1
  </p>
  <p class="Code_Indented">
   sensor_type = ENVI_SENSOR_TYPE('quickbird')
  </p>
  <p class="Code_Indented">
   ENVI_CHANGE_HEAD, fid1, SENSOR_TYPE = sensor_type
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   ; Open image 2
  </p>
  <p class="Code_Indented">
   ENVI_OPEN_DATA_FILE, inputimage2, /TIFF, R_FID=fid2
  </p>
  <p class="Code_Indented">
   sensor_type = ENVI_SENSOR_TYPE('quickbird')
  </p>
  <p class="Code_Indented">
   ENVI_CHANGE_HEAD, fid2, SENSOR_TYPE = sensor_type
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   ; Open the DEM
  </p>
  <p class="Code_Indented">
   ENVI_OPEN_FILE, inputdem, R_FID=dfid
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   ; Pass data to the Rigorous Ortho module
  </p>
  <p class="Code_Indented">
   ENVI_DOIT, 'ENVI_RIGOROUS_ORTHO_DOIT', $
  </p>
  <p class="Code_Indented">
   &#160;&#160;R_FID = ofid, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;FID = [fid1,fid2], $
  </p>
  <p class="Code_Indented">
   &#160;&#160;DEM_FID = dfid, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;DEM_POS = 1, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;GCPS = inputgcps, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;TIE_POINTS=inputties, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;PIXEL_SIZE = pixel_size, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;FILETYPE = filetype, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;AUTOCOLOR = autocolor, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;OUT_NAME = filename1
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   ; Reproject the orthorectified UTM file to a geographic
  </p>
  <p class="Code_Indented">
   ; coordinate system
  </p>
  <p class="Code_Indented">
   ENVI_OPEN_DATA_FILE, filename1, R_FID = ofid, /TIFF
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   ; Output projection parameters
  </p>
  <p class="Code_Indented">
   filename2 = 'c:\workdata\Ortho_Output_Reprojected'
  </p>
  <p class="Code_Indented">
   ENVI_FILE_QUERY, ofid, DIMS = dims, NB = nb, FNAME = fname
  </p>
  <p class="Code_Indented">
   POS = lindgen(nb)
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   o_proj=ENVI_PROJ_CREATE(/GEOGRAPHIC)
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code_Indented">
   ; Convert the file map projection
  </p>
  <p class="Code_Indented">
   ENVI_CONVERT_FILE_MAP_PROJECTION, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;R_FID = rfid, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;FID = ofid, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;POS = pos, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;DIMS = dims, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;O_PROJ = o_proj, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;RESAMPLING = 0, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;WARP_METHOD = 2, $
  </p>
  <p class="Code_Indented">
   &#160;&#160;OUT_NAME = filename2
  </p>
  <p class="Code_Indented">
   &#160;
  </p>
  <p class="Code">
   END
  </p>
  <p>
   The process will take several minutes to complete. Output will consist of the following files:
  </p>
  <ul>
   <li value="1">
    <code>
     Ortho_Output.tif
    </code>
    : orthorectified base image in a UTM WGS-84 projection
   </li>
   <li value="2">
    <code>
     Ortho_Output_project_summary.txt
    </code>
    : summary file listing data used in the project
   </li>
   <li value="3">
    <code>
     Ortho_Output_Reprojected
    </code>
    : Orthorectified image in
    <span class="DocumentTitleProductName">
     ENVI
    </span>
    format, reprojected to a geographic coordinate system
   </li>
   <li value="4">
    <code>
     Ortho_Output_Reprojected.hdr
    </code>
    : Header file for above
   </li>
  </ul>
  <p>
   The resulting images are added to the
   <span class="DocumentTitleProductName">
    ENVI
   </span>
   Available Bands List. To validate the results, open the two images (
   <code>
    Ortho_Output.tif
   </code>
   and
   <code>
    Ortho_Output_Reprojected
   </code>
   ) in separate display groups. From one of the Display group menu bars, select
   <b>
    Tools &gt; Link &gt; Geographic Link
   </b>
   . In the Geographic Link dialog, use the toggle buttons to turn both images
   <b>
    On
   </b>
   . Select a location in either image to move to the corresponding location in the other image.
  </p>
  <div class="mp_footer">
   Copyright ©
   <span class="DocumentTitleCopyrightYear">
    2012
   </span>
   <![CDATA[ ]]>
   <span class="DocumentTitleCopyrightCompanyName">
    Exelis Visual Information Solutions, Inc.
   </span>
   All Rights Reserved.
  </div>
  <script type="text/javascript" src="../../../SkinSupport/MadCapBodyEnd.js">
  </script>
 </body>
</html>